name: Media Radar Ingest

on:
  schedule:
    # Run 3 times a day (e.g., 8am, 1pm, 6pm UTC+8 -> 00, 05, 10 UTC)
    - cron: '0 0,5,10 * * *'
  workflow_dispatch:

jobs:
  ingest:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Secrets
        env:
          INTAKE_URL: ${{ secrets.INTAKE_URL }}
        run: |
          if [ -z "$INTAKE_URL" ]; then
            echo "::error::Missing INTAKE_URL secret. Please configure it in Settings -> Secrets and variables -> Actions."
            exit 1
          fi

      - name: Trigger Ingest API
        env:
          INTAKE_URL: ${{ secrets.INTAKE_URL }}
          INTAKE_TOKEN: ${{ secrets.INTAKE_TOKEN }}
        run: |
          curl -sS -X POST "$INTAKE_URL" \
            -H "x-intake-token: $INTAKE_TOKEN" \
            -H "Content-Type: application/json" \
            -d '{"source":"github-actions"}'
